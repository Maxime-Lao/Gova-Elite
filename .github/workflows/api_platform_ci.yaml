name: Api platform CI

on:
  push:
    paths:
    - 'server/**'
    branches:
    - main
  pull_request:
    paths:
    - 'server/**'
    branches:
    - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup .env
      run: |
        echo "DATABASE_URL=${{ secrets.DATABASE_URL }}" >> server/.env
        echo "APP_ENV=${{ secrets.APP_ENV }}" >> server/.env

    - name: Install dependencies
      run: cd server && composer install
      
    - name : Start docker-compose
      run : docker-compose up -d 
